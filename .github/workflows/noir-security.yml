name: OWASP Noir Security Scan (Frontend)

on:
  workflow_dispatch:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]

jobs:
  noir-security:
    name: Run OWASP Noir (Frontend)
    permissions:
      contents: read
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      # --- 1) SAST (c√≥digo fuente) ---
      - name: OWASP Noir - Source Code Scan
        uses: owasp-noir/noir@v0.25.0
        with:
          base_path: "."
          include_path: |
            src
            public
            package.json
            vite.config.ts
            tailwind.config.js
          format: "json"
          output_file: "noir-source.json"
          passive_scan: true
          passive_scan_severity: high

      # --- 2) DAST (live site) ---
      - name: OWASP Noir - Live App Scan
        uses: owasp-noir/noir@v0.25.0
        with:
          url: "https://smartpot.app"
          format: "json"
          output_file: "noir-live.json"
          passive_scan: true
          passive_scan_severity: high

      - name: Upload Noir Reports
        uses: actions/upload-artifact@v4
        with:
          name: noir-results
          path: |
            noir-source.json
            noir-live.json
