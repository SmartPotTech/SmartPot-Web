name: OWASP Noir Security Scan (Frontend)

permissions:
  contents: read

on:
  workflow_dispatch:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]

jobs:
  noir-security:
    name: Run OWASP Noir (Frontend)
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: OWASP Noir - Source Code Scan
        uses: owasp-noir/noir@v0.25.0
        continue-on-error: true
        with:
          base_path: "."
          include_path: |
            src
            public
          format: "json"
          output_file: "noir-source.json"
          passive_scan: true
          passive_scan_severity: high

      - name: OWASP Noir - Live App Scan
        uses: owasp-noir/noir@v0.25.0
        continue-on-error: true
        with:
          url: "https://smartpot.app"
          format: "json"
          output_file: "noir-live.json"
          passive_scan: true
          passive_scan_severity: high

      - name: Ensure Noir reports exist
        run: |
          [ -f noir-source.json ] || echo '{}' > noir-source.json
          [ -f noir-live.json ] || echo '{}' > noir-live.json

      - name: Upload Noir Reports
        uses: actions/upload-artifact@v4
        with:
          name: noir-results
          path: |
            noir-source.json
            noir-live.json
